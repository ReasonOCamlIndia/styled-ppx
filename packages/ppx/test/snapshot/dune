(executables
 (names pp)
 (modules pp)
 (libraries styled-ppx.lib ppxlib))

(rule
 (targets snapshot.actual.re)
 (deps
  (:pp pp.exe)
  (:input snapshot.re))
 (action
  (progn
   (with-stdout-to
    %{targets}
    (run refmt --parse re --print ml %{input}))
   (run ./%{pp} --impl %{targets} -o %{targets})
   (run refmt --parse ml --print re --in-place %{targets}))))

(rule
 (alias ppx_snapshot_test)
 (deps
  (file snapshot.expected.re)
  (file snapshot.actual.re))
 (action
  (diff snapshot.expected.re snapshot.actual.re)))
