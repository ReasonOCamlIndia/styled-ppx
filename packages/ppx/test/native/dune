(library
 (name StyledPpxTestNativeLib)
 (modules
  (:standard \ static_css_tests selectors_css_tests ; media_query_css_tests
    keyframe_css_tests Runner))
 (library_flags (-linkall -g))
 (libraries MockBsCss rely.lib styled-ppx.lib ppxlib)
 (preprocess (pps ppxlib.metaquot styled-ppx.lib))
)

(executable
 (name Runner)
 (modules Runner)
 (libraries StyledPpxTestNativeLib styled_ppx_css_parser)
 (preprocess
  (pps ppxlib.metaquot styled-ppx.lib)
 )
)

; type check

(rule
 (targets
    static_css_tests.ml
    selectors_css_tests.ml
    ; media_query_css_tests.ml
    keyframe_css_tests.ml
  )
 (deps ./Runner.exe)
 (action (run %{deps}))
)

(library
 (name StyledPpxTestNativeTypeCheck)
 (libraries MockBsCss)
 (modules
   static_css_tests
   selectors_css_tests
   ; media_query_css_tests
   keyframe_css_tests
 )
 (preprocess
  (pps styled-ppx.lib ppxlib.metaquot)
 )
)

(rule
 (alias native_typecheck_test)
 (deps
   .StyledPpxTestNativeTypeCheck.objs/byte/styledPpxTestNativeTypeCheck__Static_css_tests.cmi
   .StyledPpxTestNativeTypeCheck.objs/byte/styledPpxTestNativeTypeCheck__Selectors_css_tests.cmi
   ; .StyledPpxTestNativeTypeCheck.objs/byte/styledPpxTestNativeTypeCheck__Media_query_css_tests.cmi
   .StyledPpxTestNativeTypeCheck.objs/byte/styledPpxTestNativeTypeCheck__Keyframe_css_tests.cmi)
 (action ; this is only because a action is required
  (echo "Typecheck tests runned successfully")
 )
)
